<div class="grid">
    <div class="col-12">
        <div class="card">
            <div class="textFilterPos">
                <h4 class="mg-l-9">Danh sách nhân viên</h4>
            </div>
            <div class="grid p-pluid mt-4">
                <div class="formSearchText formsearch-posi">
                    <input type="text" placeholder="Tìm kiếm theo mã, tên nhân viên... " name="searchProject" [(ngModel)]="search" 
                    (keyup.Enter)="onSearch($event)" (keyup)="isInputEmpty = search === ''" value="" class="StextSingle_Project">
                    <button class="iconbtnSearch"  *ngIf="!isInputEmpty"><span class="pi pi-times mg-t-10" style="font-size: 1rem" (click)="onClearInput()"></span></button>
                </div>
            </div>
            <div class="grid formgrid" [formGroup]="fSearch">
                <div class="field p-fluid center-text-inpos">
                    <p-dropdown
                        [options]="lstProject"
                        placeholder="Khu đô thị"
                        emptyMessage="Không có dữ liệu."
                        [showClear]="true"
                        formControlName="ProjectId"
                        optionLabel="Name"
                        optionValue="Id"
                        (onChange)="onSelect($event)">
                    </p-dropdown>
                </div>
                <div class="field p-fluid center-text-inpos">
                    <p-dropdown
                        [options]="lstDepartment"
                        placeholder="Phòng ban"
                        emptyMessage="Không có dữ liệu."
                        [showClear]="true"
                        formControlName="DepartmentId"
                        optionLabel="Name"
                        optionValue="Id"
                        (onChange)="onSelectDepartment($event)">
                    </p-dropdown>
                </div>
                <div class="field p-fluid center-text-inpos">
                    <p-dropdown
                        [options]="lstPosition"
                        placeholder="Chức vụ"
                        emptyMessage="Không có dữ liệu."
                        [showClear]="true"
                        formControlName="PositionId"
                        optionLabel="Name"
                        optionValue="Id"
                        (onChange)="onSelectPosition($event)">
                    </p-dropdown>
                </div>         
                <div class="field p-fluid center-text-inpos">
                    <p-dropdown
                        [options]="IsAccounts"
                        placeholder="Tài khoản"
                        emptyMessage="Không có dữ liệu."
                        [showClear]="true"
                        formControlName="IsAccount"
                        optionLabel="label"
                        optionValue="value"
                        (onChange)="onSelectAccount($event)">
                    </p-dropdown>
                </div>
            </div>
            <section class="FilterProject mb-2">
                <div class="addProjectList btn-options">
                    <button type="button" pButton icon="fa fa-plus-circle" label="Thêm mới" routerLink="/category/employee/create"></button>
                </div>
            </section>
            <p-table
                [value]="lstEmployee"
                [paginator]="true"
                [rows]="10"
                [showCurrentPageReport]="true"
                [tableStyle]="{ 'min-width': '50rem' }"
                currentPageReportTemplate="Hiển thị {first} đến {last} của {totalRecords} mục nhập"
                [rowsPerPageOptions]="[10, 25, 50]"
                [loading]="isLoadingTable">
                <ng-template pTemplate="header">
                    <tr>
                        <th style="width: 5%">STT</th>
                        <th style="width: 10%">Mã nhân viên</th>
                        <th style="width: 15%">Tên nhân viên</th>
                        <th style="width: 10%">Số điện thoại</th>
                        <th style="width: 15%">CCCD/Hộ chiếu</th>
                        <th style="width: 15%">Khu đô thị</th>
                        <th style="width: 10%">Phòng ban</th>
                        <th style="width: 10%">Chức vụ</th>
                        <th style="width: 15%">Thao tác</th>

                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-employee let-rowIndex="rowIndex">
                    <tr>
                        <td>
                            {{ rowIndex + 1 }}
                        </td>
                        <td>{{ employee.Code }}</td>
                        <td>{{ employee.FullName }}</td>
                        <td>{{ employee.Phone }}</td>
                        <td>{{ employee.CardId }}</td>
                        <td>
                            <span *ngFor="let items of employee.listProjectMaps;let last=last">{{items?.ProjectName}}<span *ngIf="!last">, </span></span>
                        </td>
                        <td>{{ employee.department?.Name }}</td>
                        <td>{{ employee.position?.Name }}</td>
                        <td>
                            <!-- <button pButton pRipple icon="pi pi-arrow-right-arrow-left" class="p-button-rounded p-button-success mr-2"></button> -->
                            <button *ngIf="employee.IsAccount == true" pButton pRipple icon="pi pi-arrow-right-arrow-left" pTooltip="Đổi mật khẩu nhân viên" class="p-button-rounded p-button-info mr-2 mt-2"
                            (click)="onOpenDialogResetPassword(employee)">
                            </button>
                            <button *ngIf="employee.IsAccount === false"  pTooltip="Thêm tài khoản cho nhân viên"  pButton pRipple icon="pi pi-user-plus" class="p-button-rounded mr-2 mt-2"
                                routerLink="/category/employee/add-account/{{employee.Id}}">
                            </button>
                            <button pButton pRipple icon="pi pi-pencil" pTooltip="Sửa thông tin nhân viên" class="p-button-rounded p-button-success mr-2" 
                                routerLink="/category/employee/update/{{employee.Id}}">
                            </button>
                            <button *ngIf="employee?.user?.Status == 98 && employee.IsAccount === true" pButton pRipple icon="pi pi-lock-open" pTooltip="Mở khóa tài khoản cư dân" 
                                class="p-button-rounded p-toggleButton-lock p-button-secondary mr-2 mt-2" (click)="onLockAccount(employee)">
                            </button>
                            <button *ngIf="employee?.user?.Status == 1 && employee.IsAccount === true" pButton pRipple icon="pi pi-lock" pTooltip="Khóa tài khoản cư dân" 
                                class="p-button-rounded p-toggleButton-lock p-button-secondary mr-2 mt-2" (click)="onLockAccount(employee)">
                            </button>
                            <button pButton pRipple *ngIf="employee.IsAccount == true" icon="pi pi-cog" pTooltip="Sửa tài khoản và phân quyền của nhân viên" class="p-button-rounded p-button-secondary mr-2 mt-2" 
                                routerLink="/category/employee/add-account/{{employee.Id}}">
                            </button>
                            <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-warning mt-2"
                                (click)="onDelete(employee.Id,rowIndex)">
                            </button>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr class="text-center">
                                <td colspan="9" class="text-center text-danger">Không có dữ liệu.</td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>
</div>
<p-toast></p-toast>
<p-confirmDialog class="custom-toast"></p-confirmDialog>

